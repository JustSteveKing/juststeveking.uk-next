<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <title>Embracing PSRs to build an interoperable Http Client</title>

        <script type="module">
            document.documentElement.classList.remove('no-js');
            document.documentElement.classList.add('js');
        </script>

        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i,900,900i" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,700,700i,800,800i,900,900i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=1a1396f4c022d69a6250">

        <meta name="description" content="Recently I have been scratching my head over PSR-18. As a new PSR there isn&#039;t a lot of information around it, but I saw that as a challenge. I decided to accept this challenge and build a compliant HTTP client to embrace the future of interoperability.">

        <meta property="og:title" content="Embracing PSRs to build an interoperable Http Client">
        <meta property="og:description" content="Recently I have been scratching my head over PSR-18. As a new PSR there isn&#039;t a lot of information around it, but I saw that as a challenge. I decided to accept this challenge and build a compliant HTTP client to embrace the future of interoperability.">
        <meta property="og:image" content="/assets/images/uploads/christian-fregnan-tavkurx-xlw-unsplash.jpg">
        <meta property="og:image:alt" content="JustSteveKing - Consultant CTO, Freelance Software Engineer, Community Advocate">
        <meta property="og:locale" content="en_GB">
        <meta property="og:type" content="article">
        <meta proporty="og:url" content="/embracing-psrs-to-build-an-interoperable-http-client">

        <meta name="twitter:widgets:new-embed-design" content="on">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Embracing PSRs to build an interoperable Http Client">
        <meta name="twitter:description" content="Recently I have been scratching my head over PSR-18. As a new PSR there isn&#039;t a lot of information around it, but I saw that as a challenge. I decided to accept this challenge and build a compliant HTTP client to embrace the future of interoperability.">
        <meta name="twitter:site" content="@JustSteveKing">
        <meta name="twitter:creator" content="@JustSteveKing">
        <meta name="twitter:image" content="/assets/images/uploads/christian-fregnan-tavkurx-xlw-unsplash.jpg">
        <meta name="twitter:image:alt" content="JustSteveKing - Consultant CTO, Freelance Software Engineer, Community Advocate">

        <link rel="canonical" href="/embracing-psrs-to-build-an-interoperable-http-client">

        <link rel="icon" href="/assets/favicon.ico">
        <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
        <link rel="apple-touch-icon" href="/assets/favicon.png">
        <link rel="manifest" href="/assets/site.webmanifest">
        <meta name="theme-color" content="#ffffff">
        
        <script src="/assets/build/js/main.js?id=718247a870e5977545e7" defer></script>
        
        <script type="application/ld+json">
        {
            "@content": "https://schema.org/",
            "@type": "Person",
            "name": "Steve McDougall",
            "url": "https://www.juststeveking.uk/",
            "image": "https://www.juststeveking.uk/images/avatar.png",
            "sameAs": [
                "https://github.com/JustSteveKing",
                "https://twitter.com/JustSteveKing",
                "https://www.linkedin.com/in/steve-mcdougall/"
            ],
            "jobTitle": "Technical Lead",
            "worksFor": {
                "@type": "Organization",
                "name": "Squarefoot Capital Limited",
                "url": "https://sqft.capital",
                "foundingDate": "2019-10-10",
                "sameAs": [
                    "https://www.linkedin.com/company/squarefootcapital/"
                ],
                "description": "sqft.capital is a platform solely for UK property developers to model deals and raise funding, quickly and consistently." 
            }
        }
        </script>

                    <!-- Fathom - beautiful, simple website analytics -->
            <script
                src="https://cdn.usefathom.com/script.js"
                data-site="SGJKEWOR"
                defer
            ></script>
            <!-- / Fathom -->
            </head>
    <body class="antialiased bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-50">
         <nav class="container mx-auto py-12">
    <ul class="flex items-center justify-center space-x-6 uppercase">
                    <li>
                 <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" title="Return Home" href="/"
    title="Return Home" href="/"
>
    Home
</a> 
            </li>
                    <li>
                 <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" title="Recent Articles" href="/blog"
    title="Recent Articles" href="/blog"
>
    Articles
</a> 
            </li>
                    <li>
                 <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" title="Open Source packages I have made" href="/open-source"
    title="Open Source packages I have made" href="/open-source"
>
    Open Source
</a> 
            </li>
            </ul>
</nav> 
        
            <main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0">
        <article class="xl:divide-y xl:divide-gray-200">
            <header class="pt-6 xl:pb-10">
                <div class="space-y-1 text-center">
                    <dl class="space-y-10">
                        <div>
                            <dt class="sr-only">
                                Published on
                            </dt>
                            <dd class="text-base leading-6 font-medium">
                                <time datetime="2020-05-29">
                                    Friday, 29th May 2020
                                </time>
                            </dd>
                        </div>
                    </dl>
                    <div>
                        <h1 class="text-3xl leading-9 font-extrabold tracking-wider sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">
                            Embracing PSRs to build an interoperable Http Client
                        </h1>
                    </div>
                </div>
            </header>

        <div class="divide-y xl:divide-y-0 divide-gray-200 xl:grid xl:grid-cols-4 xl:col-gap-6 pb-16 xl:pb-20" style="grid-template-rows: auto 1fr;">
            <dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200">
                <dt class="sr-only">Authors</dt>
                <dd>
                    <ul class="flex justify-center xl:block space-x-8 sm:space-x-12 xl:space-x-0 xl:space-y-8">
                        <li class="flex items-center space-x-2">
                             <img
    src="/assets/images/avatar.png"
    alt="Steve McDougall Avatar"
    class="object-fit object-center rounded-full w-10 h-10"
/> 
                            <dl class="text-sm font-medium leading-5 whitespace-no-wrap">
                                <dt class="sr-only">Name</dt>
                                <dd>Steve McDougall</dd>
                                <dt class="sr-only">Twitter</dt>
                                <dd>
                                     <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" href="https://twitter.com/JustSteveKing" target="__blank" rel="noopener nofollow" title="Follow Steve on twitter"
    href="https://twitter.com/JustSteveKing" target="__blank" rel="noopener nofollow" title="Follow Steve on twitter"
>
    @JustSteveKing
</a> 
                                </dd>
                            </dl>
                        </li>
                    </ul>
                </dd>
            </dl>
            <div class="divide-y divide-gray-200 xl:pb-0 xl:col-span-3 xl:row-span-2">
                <div class="max-w-3xl leading-8 text-lg space-y-3 text-gray-800 dark:text-gray-50 pt-10 pb-8 px-3">
                    <img src="/assets/images/uploads/christian-fregnan-tavkurx-xlw-unsplash.jpg"
                        alt="Embracing PSRs to build an interoperable Http Client"
                        class="rounded shadow-md"
                    />
                    <p>Recently I have been scratching my head over PSR-18. As a new PSR there isn't
a lot of information around it, but I saw that as a challenge. I decided to
accept this challenge and build a compliant HTTP client to embrace the future
of interoperability.</p>

<p>If you look at the specifications for <a href="https://www.php-fig.org/psr/psr-18/">PSR-18 on PHP-FIG</a> they are typically pretty confusing, but I read between the lines a little. The first step was to build a class that would accept all the necessary components to bootstrap the client.</p>

<pre><code class="language-php"><br />&lt;?php


declare(strict_types=1);


namespace JustSteveKing\HttpSlim;


use Psr\Http\Message\StreamFactoryInterface;

use Psr\Http\Message\RequestFactoryInterface;

use Psr\Http\Client\ClientExceptionInterface;


class HttpClient implements HttpClientInterface

{
protected ClientInterface $client;

protected StreamFactoryInterface $streamFactory;

protected RequestFactoryInterface $requestFactory;
}

</code></pre>

<p>Now if you have read any of my other posts, or used any of my packages, or seen my posts on twitter, you will know I am a huge fan of named constructors.</p>

<pre><code class="language-php"><br />&lt;?php


final protected function __construct(
ClientInterface $client,
RequestFactoryInterface $requestFactory,
StreamFactoryInterface $streamFactory
) {
$this-&gt;client = $client;
$this-&gt;requestFactory = $requestFactory;
$this-&gt;streamFactory = $streamFactory;
}


public static function build(
ClientInterface $client,
RequestFactoryInterface $requestFactory,
StreamFactoryInterface $streamFactory
): self {
return new static(
$client,
$requestFactory,
$streamFactory
);
}

</code></pre>

<p>This gives us a good starting point to begin with, from here we can implement our helper methods for making requests and encoding json. Our helper methods follow a typical pattern of, take a URL and an optional body as an array - making sure that we return a PSR-7 compliant Response (but that it typically down to the client library we inject). Here is an example of the post request:</p>

<pre><code class="language-php"><br />&lt;?php


...

use \JsonException;

use Psr\Http\Message\ResponseInterface;

use JustSteveKing\HttpSlim\Exceptions\RequestError;

...


public function post(string $uri, array $body): ResponseInterface

{
// build out json body content
try {
$content = $this-&gt;encodeJson($body);
} catch (JsonException $exception) {
throw RequestError::invalidJson($exception); 
}

$request = $this-&gt;requestFactory-&gt;createRequest('POST', $uri)
    -&gt;withAddedHeader('Content-Type', 'application/json')
    -&gt;withBody($this-&gt;streamFactory-&gt;createStream($content));

return $this-&gt;client-&gt;sendRequest($request);
}

</code></pre>

<p>Our encodeJson method simply returns a json encoded version of the passed through array.</p>

<p>This is just one adventure into embracing PSRs, but I have thoroughly enjoyed it so far! Please drop me a tweet if you have found this useful at all, or if you find an issue - feel free to drop an issue on the <a href="https://github.com/JustSteveKing/http-slim">GitHub repo</a></p>
                </div>
            </div>
            <footer class="text-sm font-medium leading-5 divide-y divide-gray-200 xl:col-start-1 xl:row-start-2">
                <div class="space-y-8 py-8">
                    <div>
                        <h2 class="text-xs tracking-wide uppercase">
                            Tags
                        </h2>
                        <div class="space-x-2 flex flex-wrap">
                                                             <a
    class="cursor-pointer hover:underline text-indigo-500 dark:text-indigo-200 hover:text-indigo-800 dark:hover:text-indigo-50" href="/blog/tags/php" title="View articles in php"
    href="/blog/tags/php" title="View articles in php"
>
    php
</a> 
                                                             <a
    class="cursor-pointer hover:underline text-indigo-500 dark:text-indigo-200 hover:text-indigo-800 dark:hover:text-indigo-50" href="/blog/tags/open source" title="View articles in open source"
    href="/blog/tags/open source" title="View articles in open source"
>
    open source
</a> 
                                                             <a
    class="cursor-pointer hover:underline text-indigo-500 dark:text-indigo-200 hover:text-indigo-800 dark:hover:text-indigo-50" href="/blog/tags/package" title="View articles in package"
    href="/blog/tags/package" title="View articles in package"
>
    package
</a> 
                                                             <a
    class="cursor-pointer hover:underline text-indigo-500 dark:text-indigo-200 hover:text-indigo-800 dark:hover:text-indigo-50" href="/blog/tags/psr" title="View articles in psr"
    href="/blog/tags/psr" title="View articles in psr"
>
    psr
</a> 
                                                    </div>
                    </div>
                </div>
                <div class="space-y-8 py-8">
                    <div>
                        <h2 class="text-xs tracking-wide uppercase">
                            Reading Time
                        </h2>
                        <div class="space-x-2 flex flex-wrap">
                            <p>2 min read</p>
                        </div>
                    </div>
                </div>
                <div class="pt-8">
                    <a class="text-teal-500 hover:text-teal-600" href="/">
                        ← Back to the blog
                    </a>
                </div>
            </footer>
        </div>
        </article>
    </main>
        
         <footer>
    <div class="max-w-7xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8">
        <nav class="-mx-5 -my-2 flex flex-wrap justify-center" aria-label="Footer">
                            <div class="px-5 py-2 uppercase">
                     <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" title="Return Home" href="/"
    title="Return Home" href="/"
>
    Home
</a> 
                </div>
                            <div class="px-5 py-2 uppercase">
                     <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" title="Recent Articles" href="/blog"
    title="Recent Articles" href="/blog"
>
    Articles
</a> 
                </div>
                            <div class="px-5 py-2 uppercase">
                     <a
    class="cursor-pointer text-gray-600 dark:text-gray-200 hover:text-gray-800 dark:hover:text-gray-50" title="Open Source packages I have made" href="/open-source"
    title="Open Source packages I have made" href="/open-source"
>
    Open Source
</a> 
                </div>
                    </nav>
        <div class="mt-8 flex justify-center space-x-6">

             <a
    class="cursor-pointer text-gray-400 hover:text-linkedin" title="Visit me on LinkedIn" href="https://www.linkedin.com/in/steve-mcdougall/"
    title="Visit me on LinkedIn" href="https://www.linkedin.com/in/steve-mcdougall/" class="hover:text-linkedin"
    target="__blank"
    rel="noopener nofollow"
>
    <span class="sr-only">LinkedIn</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
</a> 

             <a
    class="cursor-pointer text-gray-400 hover:text-twitter" title="Visit me on twitter" href="https://twitter.com/JustSteveKing"
    title="Visit me on twitter" href="https://twitter.com/JustSteveKing" class="hover:text-twitter"
    target="__blank"
    rel="noopener nofollow"
>
    <span class="sr-only">twitter</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
</a> 

             <a
    class="cursor-pointer text-gray-400 hover:text-github dark:hover:text-white" title="Visit me on GitHub" href="https://github.com/JustSteveKing"
    title="Visit me on GitHub" href="https://github.com/JustSteveKing" class="hover:text-github dark:hover:text-white"
    target="__blank"
    rel="noopener nofollow"
>
    <span class="sr-only">GitHub</span>
                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
                </svg>
</a> 

             <a
    class="cursor-pointer text-gray-400 hover:text-discord" title="Visit me on Discord" href="https://discordapp.com/users/533726823201243137"
    title="Visit me on Discord" href="https://discordapp.com/users/533726823201243137" class="hover:text-discord"
    target="__blank"
    rel="noopener nofollow"
>
    <span class="sr-only">Discord</span>
                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
                </svg>
</a> 

             <a
    class="cursor-pointer text-gray-400 hover:text-telegram" title="Visit me on telegram" href="https://t.me/JustSteveKing"
    title="Visit me on telegram" href="https://t.me/JustSteveKing" class="hover:text-telegram"
    target="__blank"
    rel="noopener nofollow"
>
    <span class="sr-only">telegram</span>
                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M11.944 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0a12 12 0 00-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 01.171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
</a> 

        </div>
        <p class="mt-8 text-center text-base text-gray-400">
            &copy; 2021 Steve McDougall. All rights reserved.
        </p>
    </div>
</footer> 
    </body>
</html>
